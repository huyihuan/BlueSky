!function(a){a&&a.component&&(a.extend(!1,a.component,{Window:function(){var b=arguments[0];return a.extend(!0,{},this,b)}}),a.extend(!0,a.component.Window,{items:[],status:{Normal:1,Min:2,Max:3},display:{Show:1,Hide:2},dialogResult:{OK:1,Cancel:0},configs:{defaultIconURL:"Include/image/application.png",titleHeight:25,minWidth:150,minHeight:150,borderWidth:6},activeWindow:null}),a.extend(!1,a.component.Window.prototype,{id:"",key:"",width:300,height:200,title:"Î´ÃüÃû",renderTo:null,"static":null,status:null,position:{x:-1,y:-1},nodes:{wrapper:null,title:null,main:null,frame:null,close:null,max:null,min:null},loader:{url:"",autoRefresh:!1,tick:0,onLoad:null},focus:!1,display:null,resizeable:!1,minimum:!1,maximum:!1,closeable:!0,inTaskBar:!1,moveable:!1,drag:null,resizer:null,target:null,html:null,zIndex:0,returnValue:null,arguments:null,mask:!1,masklayer:null,flicker:!1,icon:{show:!0,url:""},controls:[],onClosing:null,onClosed:null,show:function(){var b,c;this.static=a.component.Window,this.status=this.static.status.Normal,this.display=this.static.display.Show,this.target=a(this.renderTo),""==this.id&&(this.id="BlueskyWindow"+(this.static.items.length+1)),this.minimum&&(this.inTaskBar=!0),b=this,c="",this.icon.show&&(""==this.url&&(this.icon.url=this.static.configs.defaultIconURL),c="<img class='window-icon' src='"+this.icon.url+"' align='absMiddle' />",delete this.icon.url),c="<nobr>"+c+this.title+"</nobr>",this.nodes.title=a.create("div",{className:"window-title window-title-normal"}).height(this.static.configs.titleHeight),delete this.title,this.nodes.title.append(a.create("div",{className:"window-title-text",html:c})),this.closeable&&(this.nodes.close=a.create("a",{className:"window-button window-button-close"}).addEvent("click",function(){b.close(),setTimeout(function(){b=null},0)}),this.nodes.title.append(this.nodes.close)),this.maximum&&(this.nodes.max=a.create("a",{className:"window-button window-button-max"}).addEvent("click",function(){b.toggleStatus()}),this.nodes.title.append(this.nodes.max),this.nodes.title.addEvent("dblclick",function(){b.toggleStatus()})),this.minimum&&(this.nodes.min=a.create("a",{className:"window-button window-button-min",html:""}).addEvent("click",function(){b.toMin()}),this.nodes.title.append(this.nodes.min)),this.nodes.main=a.create("div",{className:"window-main"}).height(this.height-this.static.configs.titleHeight-1-this.static.configs.borderWidth).width(this.width-2*this.static.configs.borderWidth).css("margin","0px 0px 0px "+(this.static.configs.borderWidth-1)+"px"),this.loader&&this.loader.url&&(this.nodes.frame=a.create("iframe",{width:"100%",height:"100%",frameBorder:"0"}),this.nodes.frame.addEvent("focus",function(){b.toFocus()}),"function"==typeof this.loader.onLoad&&this.nodes.frame.addEvent("load",function(){b.nodes.frame.window&&(b.nodes.frame.window.arguments=b.arguments),b.loader.onLoad.call(b)}),setTimeout(function(){b.nodes.frame.attr("src",b.loader.url)},0),this.nodes.main.append(this.nodes.frame)),-1==this.position.x&&-1==this.position.y&&(this.position.x=(this.target.width()-this.width)/2,this.position.y=(this.target.height()-this.height)/2),this.nodes.wrapper=a.create("div",{className:"window-popup window-normal",id:this.id}).height(this.height).width(this.width).css({left:this.position.x+"px",top:this.position.y+"px"}),this.nodes.wrapper.append(this.nodes.title).append(this.nodes.main).addEvent("mousedown",function(c){b.toFocus(),a.stopPropagation(c)}),this.resizeable&&(this.resizer=new a.component.Resizer({context:this,target:this.nodes.wrapper,onResizeEnd:function(a){var c=a.endSize,d=a.endPosition;c.height!=this.height&&this.nodes.main.height(c.height-this.static.configs.titleHeight-1-this.static.configs.borderWidth),c.width!=this.width&&this.nodes.main.width(c.width-2*this.static.configs.borderWidth),b.height=c.height,b.width=c.width,b.position={x:d.x,y:d.y}}}),this.resizer.init()),this.moveable&&(this.drag=new a.component.Drag({context:this,mover:this.nodes.wrapper,operater:this.nodes.title,onDragStart:function(){return b.status==b.static.status.Max?!1:void 0},onDragEnd:function(a){b.position.x=a.endPosition.x,b.position.y=a.endPosition.y}}),this.drag.init()),this.mask===!0&&(this.masklayer=new a.component.Masklayer({onClick:this.flicker?function(){var a=1,c=b.nodes.title,d=b.nodes.wrapper,e=c.hasClass("window-title-active"),f=function(){c.replaceClass("window-title-"+(e?"active":"normal"),"window-title-"+(e?"normal":"active")),d.toggleClass("window-flicker",e),a++<=5||clearInterval(g),e=!e},g=setInterval(f,90)}:null}),this.masklayer.show(),this.zIndex=this.masklayer.zIndex+1),this.zIndex>0&&this.nodes.wrapper.css("zIndex",this.zIndex),this.target.append(this.nodes.wrapper),this.static.items.push(this.static.activeWindow=this.toFocus())},close:function(){var a,b,c,d;this.dialogResult=this.static.dialogResult.Cancel,this.loader&&""!=this.loader.url&&(a=this.nodes.frame[0].contentWindow,a&&a.dialogResult&&(this.dialogResult=a.dialogResult)),("function"!=typeof this.onClosing||(b=this.onClosing.call(this,this.dialogResult)))&&(this.nodes.wrapper.remove(),this.mask&&this.masklayer.remove(),"function"==typeof this.onClosed&&this.onClosed.call(this,this.dialogResult),c=this.static.items,d=c.indexOfProperty(this.id,"id"),-1!=d&&c.splice(d,1),c.length>=1&&c[c.length-1].toFocus())},toggleStatus:function(){var a=this.static.status;return this.status==a.Normal?this.toMax():this.status==a.Max&&this.toNormal(),this},toMax:function(){var a=this.target;return this.setPosition({x:0,y:0}),this.setSize({width:a.width()-2,height:a.height()-2}),this.nodes.max.replaceClass("window-button-max","window-button-normal"),this.status=this.static.status.Max,this},toNormal:function(){return this.setPosition(this.position),this.setSize({width:this.width,height:this.height}),this.nodes.max.replaceClass("window-button-normal","window-button-max"),this.status=this.static.status.Normal,this},toMin:function(){return this.setVisible(!1),this},toFocus:function(){return this.focus?this:(this.static.activeWindow&&this.static.activeWindow.toBlur(),this.nodes.wrapper.replaceClass("window-normal","window-active"),this.nodes.title.replaceClass("window-title-normal","window-title-active"),this.focus=!0,this.static.activeWindow=this,this)},toBlur:function(){return this.focus?(this.nodes.wrapper.replaceClass("window-active","window-normal"),this.nodes.title.replaceClass("window-title-active","window-title-normal"),this.focus=!1,this):this},setVisible:function(a){return 1==a?this.nodes.wrapper.show():this.nodes.wrapper.hide(),this},setSize:function(){var a=arguments[0];return a?(a.width>=0&&(this.nodes.wrapper.width(a.width),this.nodes.main.width(a.width-2*this.static.configs.borderWidth)),a.height>=0&&(this.nodes.wrapper.height(a.height),this.nodes.main.height(a.height-this.static.configs.titleHeight-1-this.static.configs.borderWidth)),this):this},setPosition:function(){var a=arguments[0];if(a)return this.nodes.wrapper.css({left:a.x+"px",top:a.y+"px"}),this},add:function(){var a=arguments[0];a&&(this.controls.push(a),this.nodes.main.append(a))}}))}(Bluesky);